import{r as e,b as t,m as a,w as s,o,p as i,q as r,y as l,u as n,A as c,B as d,F as g,x as A,z as p,C,D as u,E as h,K as m,a0 as E}from"./index-BrYrmhwU.js";import{_ as Q}from"./notice-icon.BKHgi8_o.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=""+new URL("right-white-BTEYPMjO.png",import.meta.url).href,B={clientId:"21680db9b1362913357c",baseUrl:"https://21680db9b1362913357c.myminapp.com/hserve/v2.2",tableNames:{more_notice:"more_notice"}};const k=f({data:()=>({noticeList:[],currentNotice:null,currentNoticeId:"",loading:!1,isLeftPanelCollapsed:!1}),computed:{sortedNoticeList(){return[...this.noticeList].sort(((e,t)=>{if(e.Top&&!t.Top)return-1;if(!e.Top&&t.Top)return 1;const a=this.parseTimeToTimestamp(e.updatedAt||e.createdAt);return this.parseTimeToTimestamp(t.updatedAt||t.createdAt)-a}))}},onLoad(e){e.id&&(this.currentNoticeId=e.id),e.isLeftPanelCollapsed&&(this.isLeftPanelCollapsed="true"===e.isLeftPanelCollapsed),this.fetchNoticeList(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:()=>({title:"方舟通行证谷子查询工具-公告",path:"/packageA/more-notice/more-notice",imageUrl:""}),onShareTimeline:()=>({title:"方舟通行证谷子查询工具-公告",imageUrl:""}),methods:{async knowCloudRequest(t,a={},s=0){if(s>3)throw console.error("知晓云请求重试次数过多"),new Error("知晓云请求重试次数过多");try{const s=B.tableNames[t];if(!s)throw new Error(`未找到表 ${t} 的配置`);let o=`${B.baseUrl}/table/${s}/record/`;if(a.data){const e=[];Object.keys(a.data).forEach((t=>{e.push(`${t}=${encodeURIComponent(a.data[t])}`)})),e.length>0&&(o+=`?${e.join("&")}`)}const i={url:o,method:a.method||"GET",header:{"X-Hydrogen-Client-ID":B.clientId,"Content-Type":"application/json"},timeout:15e3,...a};a.header&&Object.assign(i.header,a.header),console.log("发送知晓云请求:",i.url);const r=await e(i);if(console.log("知晓云响应状态:",r.statusCode),200===r.statusCode)return r.data;throw console.error("知晓云请求错误:",r.statusCode,r.data),new Error(`请求失败: ${r.statusCode}`)}catch(o){if(console.error(`知晓云请求失败 (${t}):`,o),s<3)return console.log(`第${s+1}次重试...`),await this.knowCloudRequest(t,a,s+1);throw o}},toggleLeftPanel(){this.isLeftPanelCollapsed=!this.isLeftPanelCollapsed},async fetchNoticeList(){this.loading=!0;try{const e=await this.knowCloudRequest("more_notice",{data:{limit:100,offset:0}});if(console.log("知晓云公告列表响应:",e),e&&e.objects){const t=e.objects.map((e=>({objectId:e.id||"",title:e.title||"",content:e.content||"",Top:e.Top||!1,createdAt:e.created_at||"",updatedAt:e.updated_at||""})));if(this.noticeList=t,console.log("获取公告列表成功:",this.noticeList),this.currentNoticeId){const e=this.noticeList.find((e=>e.objectId===this.currentNoticeId));e&&this.selectNotice(e)}!this.currentNotice&&this.sortedNoticeList.length>0&&this.selectNotice(this.sortedNoticeList[0])}}catch(e){console.error("获取公告列表失败:",e),t({title:"获取公告失败",icon:"none"})}finally{this.loading=!1}},selectNotice(e){this.currentNotice=e,this.currentNoticeId=e.objectId},showEditedTag(e){if(!e.createdAt||!e.updatedAt)return!1;const t=this.parseTimeToTimestamp(e.createdAt);return this.parseTimeToTimestamp(e.updatedAt)-t>6e4},parseTimeToTimestamp(e){if(!e)return 0;try{if("number"!=typeof e&&!/^\d+$/.test(e.toString())||10!==e.toString().length&&13!==e.toString().length){return new Date(e).getTime()}{const t=parseInt(e);return 10===t.toString().length?1e3*t:t}}catch(t){return console.error("解析时间失败:",t,"原始时间:",e),0}},formatTime(e){if(!e)return"";try{const t=this.parseTimeToTimestamp(e);if(0===t)return"未知时间";const a=new Date(t);return isNaN(a.getTime())?(console.warn("无效的时间格式:",e),"未知时间"):`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`}catch(t){return console.error("格式化时间失败:",t,"原始时间:",e),"string"==typeof e?e:"时间格式错误"}},parseContent(e){if(!e)return"";let t=e;return t=t.replace(/\\n/g,"\n"),t=t.replace(/\n/g,"<br>"),t=t.replace(/\r\n/g,"<br>"),t=t.replace(/\r/g,"<br>"),t=t.replace(/<br\s*\/?>/gi,"<br>"),t.replace(/<p>/gi,"<div>").replace(/<\/p>/gi,"</div>").replace(/<strong>(.*?)<\/strong>/gi,"<b>$1</b>").replace(/<b>(.*?)<\/b>/gi,"<b>$1</b>").replace(/<em>(.*?)<\/em>/gi,"<i>$1</i>").replace(/<i>(.*?)<\/i>/gi,"<i>$1</i>").replace(/<u>(.*?)<\/u>/gi,'<span style="text-decoration: underline;">$1</span>')}}},[["render",function(e,t,f,B,k,w){const T=C,S=u,R=h,b=o,J=m,y=E;return i(),a(b,{class:"container"},{default:s((()=>[r(b,{class:"content-wrapper"},{default:s((()=>[r(b,{class:l(["left-panel",{collapsed:k.isLeftPanelCollapsed}])},{default:s((()=>[r(J,{class:"title-list","scroll-y":""},{default:s((()=>[r(b,{class:"panel-header"},{default:s((()=>[r(T,{class:"panel-title"},{default:s((()=>[n("公告列表")])),_:1}),r(R,{class:"collapse-btn",onClick:w.toggleLeftPanel},{default:s((()=>[r(S,{class:"collapse-icon",src:"data:image/png;base64,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"})])),_:1},8,["onClick"])])),_:1}),(i(!0),c(g,null,d(w.sortedNoticeList,((e,t)=>(i(),a(b,{key:e.objectId,class:l(["title-item",{active:k.currentNoticeId===e.objectId,"top-item":e.Top}]),onClick:t=>w.selectNotice(e)},{default:s((()=>[r(b,{class:"title-content"},{default:s((()=>[r(T,{class:"title-text"},{default:s((()=>[n(A(e.title),1)])),_:2},1024),r(b,{class:"title-tags"},{default:s((()=>[e.Top?(i(),a(T,{key:0,class:"tag top-tag"},{default:s((()=>[n("置顶")])),_:1})):p("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["class"]),r(b,{class:l(["right-panel",{expanded:k.isLeftPanelCollapsed}])},{default:s((()=>[r(J,{class:"content-scroll","scroll-y":""},{default:s((()=>[k.currentNotice?(i(),a(b,{key:0,class:"content-container"},{default:s((()=>[r(b,{class:"content-header"},{default:s((()=>[r(b,{class:"title-row"},{default:s((()=>[r(T,{class:"content-title"},{default:s((()=>[n(A(k.currentNotice.title),1)])),_:1}),r(b,{class:"content-tags"},{default:s((()=>[k.currentNotice.Top?(i(),a(T,{key:0,class:"tag top-tag"},{default:s((()=>[n("置顶")])),_:1})):p("",!0)])),_:1})])),_:1}),r(b,{class:"time-info"},{default:s((()=>[r(T,{class:"update-time"},{default:s((()=>[n(" 更新于: "+A(w.formatTime(k.currentNotice.updatedAt)),1)])),_:1}),w.showEditedTag(k.currentNotice)?(i(),a(T,{key:0,class:"edited-text"},{default:s((()=>[n("（已编辑）")])),_:1})):p("",!0)])),_:1})])),_:1}),r(b,{class:"content-body"},{default:s((()=>[r(y,{class:"content-text",nodes:w.parseContent(k.currentNotice.content)},null,8,["nodes"])])),_:1})])),_:1})):(i(),a(b,{key:1,class:"empty-state"},{default:s((()=>[r(S,{class:"empty-icon",src:Q}),r(T,{class:"empty-text"},{default:s((()=>[n("请选择公告查看详情")])),_:1})])),_:1}))])),_:1}),k.isLeftPanelCollapsed?(i(),a(R,{key:0,class:"expand-panel-btn",onClick:w.toggleLeftPanel},{default:s((()=>[r(T,{class:"expand-text"},{default:s((()=>[n("展开列表")])),_:1}),r(S,{class:"expand-icon",src:I})])),_:1},8,["onClick"])):p("",!0)])),_:1},8,["class"])])),_:1})])),_:1})}],["__scopeId","data-v-b568f386"]]);export{k as default};
