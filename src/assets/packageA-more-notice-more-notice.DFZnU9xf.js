import{r as t,b as e,l as s,w as a,m as o,o as i,p as l,x as n,t as r,z as c,A as d,F as g,u as A,y as p,B as C,C as u,D as h,J as m,_ as E}from"./index-BFyEvU8g.js";import{_ as Q}from"./notice-icon.BKHgi8_o.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=""+new URL("right-white-BTEYPMjO.png",import.meta.url).href,B={clientId:"21680db9b1362913357c",baseUrl:"https://21680db9b1362913357c.myminapp.com/hserve/v2.2",tableNames:{more_notice:"more_notice"}};const k=f({data:()=>({noticeList:[],currentNotice:null,currentNoticeId:"",loading:!1,isLeftPanelCollapsed:!1}),computed:{sortedNoticeList(){return[...this.noticeList].sort(((t,e)=>{if(t.Top&&!e.Top)return-1;if(!t.Top&&e.Top)return 1;const s=this.parseTimeToTimestamp(t.updatedAt||t.createdAt);return this.parseTimeToTimestamp(e.updatedAt||e.createdAt)-s}))}},onLoad(t){t.id&&(this.currentNoticeId=t.id),t.isLeftPanelCollapsed&&(this.isLeftPanelCollapsed="true"===t.isLeftPanelCollapsed),this.fetchNoticeList(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:()=>({title:"方舟通行证谷子查询工具-公告",path:"/packageA/more-notice/more-notice",imageUrl:""}),onShareTimeline:()=>({title:"方舟通行证谷子查询工具-公告",imageUrl:""}),methods:{async knowCloudRequest(e,s={},a=0){if(a>3)throw console.error("知晓云请求重试次数过多"),new Error("知晓云请求重试次数过多");try{const a=B.tableNames[e];if(!a)throw new Error(`未找到表 ${e} 的配置`);let o=`${B.baseUrl}/table/${a}/record/`;if(s.data){const t=[];Object.keys(s.data).forEach((e=>{t.push(`${e}=${encodeURIComponent(s.data[e])}`)})),t.length>0&&(o+=`?${t.join("&")}`)}const i={url:o,method:s.method||"GET",header:{"X-Hydrogen-Client-ID":B.clientId,"Content-Type":"application/json"},timeout:15e3,...s};s.header&&Object.assign(i.header,s.header),console.log("发送知晓云请求:",i.url);const l=await t(i);if(console.log("知晓云响应状态:",l.statusCode),200===l.statusCode)return l.data;throw console.error("知晓云请求错误:",l.statusCode,l.data),new Error(`请求失败: ${l.statusCode}`)}catch(o){if(console.error(`知晓云请求失败 (${e}):`,o),a<3)return console.log(`第${a+1}次重试...`),await this.knowCloudRequest(e,s,a+1);throw o}},toggleLeftPanel(){this.isLeftPanelCollapsed=!this.isLeftPanelCollapsed},async fetchNoticeList(){this.loading=!0;try{const t=await this.knowCloudRequest("more_notice",{data:{limit:100,offset:0}});if(console.log("知晓云公告列表响应:",t),t&&t.objects){const e=t.objects.map((t=>({objectId:t.id||"",title:t.title||"",content:t.content||"",Top:t.Top||!1,createdAt:t.created_at||"",updatedAt:t.updated_at||""})));if(this.noticeList=e,console.log("获取公告列表成功:",this.noticeList),this.currentNoticeId){const t=this.noticeList.find((t=>t.objectId===this.currentNoticeId));t&&this.selectNotice(t)}!this.currentNotice&&this.sortedNoticeList.length>0&&this.selectNotice(this.sortedNoticeList[0])}}catch(t){console.error("获取公告列表失败:",t),e({title:"获取公告失败",icon:"none"})}finally{this.loading=!1}},selectNotice(t){this.currentNotice=t,this.currentNoticeId=t.objectId},showEditedTag(t){if(!t.createdAt||!t.updatedAt)return!1;const e=this.parseTimeToTimestamp(t.createdAt);return this.parseTimeToTimestamp(t.updatedAt)-e>6e4},parseTimeToTimestamp(t){if(!t)return 0;try{if("number"!=typeof t&&!/^\d+$/.test(t.toString())||10!==t.toString().length&&13!==t.toString().length){return new Date(t).getTime()}{const e=parseInt(t);return 10===e.toString().length?1e3*e:e}}catch(e){return console.error("解析时间失败:",e,"原始时间:",t),0}},formatTime(t){if(!t)return"";try{const e=this.parseTimeToTimestamp(t);if(0===e)return"未知时间";const s=new Date(e);return isNaN(s.getTime())?(console.warn("无效的时间格式:",t),"未知时间"):`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`}catch(e){return console.error("格式化时间失败:",e,"原始时间:",t),"string"==typeof t?t:"时间格式错误"}},parseContent:t=>t?t.replace(/\n/g,"<br>").replace(/<br\s*\/?>/gi,"<br>").replace(/<p>/gi,"<div>").replace(/<\/p>/gi,"</div>").replace(/<strong>(.*?)<\/strong>/gi,"<b>$1</b>").replace(/<b>(.*?)<\/b>/gi,"<b>$1</b>").replace(/<em>(.*?)<\/em>/gi,"<i>$1</i>").replace(/<i>(.*?)<\/i>/gi,"<i>$1</i>").replace(/<u>(.*?)<\/u>/gi,'<span style="text-decoration: underline;">$1</span>'):""}},[["render",function(t,e,f,B,k,w){const T=C,S=u,R=h,J=o,y=m,b=E;return i(),s(J,{class:"container"},{default:a((()=>[l(J,{class:"content-wrapper"},{default:a((()=>[l(J,{class:n(["left-panel",{collapsed:k.isLeftPanelCollapsed}])},{default:a((()=>[l(y,{class:"title-list","scroll-y":""},{default:a((()=>[l(J,{class:"panel-header"},{default:a((()=>[l(T,{class:"panel-title"},{default:a((()=>[r("公告列表")])),_:1}),l(R,{class:"collapse-btn",onClick:w.toggleLeftPanel},{default:a((()=>[l(S,{class:"collapse-icon",src:"data:image/png;base64,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"})])),_:1},8,["onClick"])])),_:1}),(i(!0),c(g,null,d(w.sortedNoticeList,((t,e)=>(i(),s(J,{key:t.objectId,class:n(["title-item",{active:k.currentNoticeId===t.objectId,"top-item":t.Top}]),onClick:e=>w.selectNotice(t)},{default:a((()=>[l(J,{class:"title-content"},{default:a((()=>[l(T,{class:"title-text"},{default:a((()=>[r(A(t.title),1)])),_:2},1024),l(J,{class:"title-tags"},{default:a((()=>[t.Top?(i(),s(T,{key:0,class:"tag top-tag"},{default:a((()=>[r("置顶")])),_:1})):p("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["class"]),l(J,{class:n(["right-panel",{expanded:k.isLeftPanelCollapsed}])},{default:a((()=>[l(y,{class:"content-scroll","scroll-y":""},{default:a((()=>[k.currentNotice?(i(),s(J,{key:0,class:"content-container"},{default:a((()=>[l(J,{class:"content-header"},{default:a((()=>[l(J,{class:"title-row"},{default:a((()=>[l(T,{class:"content-title"},{default:a((()=>[r(A(k.currentNotice.title),1)])),_:1}),l(J,{class:"content-tags"},{default:a((()=>[k.currentNotice.Top?(i(),s(T,{key:0,class:"tag top-tag"},{default:a((()=>[r("置顶")])),_:1})):p("",!0)])),_:1})])),_:1}),l(J,{class:"time-info"},{default:a((()=>[l(T,{class:"update-time"},{default:a((()=>[r(" 更新于: "+A(w.formatTime(k.currentNotice.updatedAt)),1)])),_:1}),w.showEditedTag(k.currentNotice)?(i(),s(T,{key:0,class:"edited-text"},{default:a((()=>[r("（已编辑）")])),_:1})):p("",!0)])),_:1})])),_:1}),l(J,{class:"content-body"},{default:a((()=>[l(b,{class:"content-text",nodes:w.parseContent(k.currentNotice.content)},null,8,["nodes"])])),_:1})])),_:1})):(i(),s(J,{key:1,class:"empty-state"},{default:a((()=>[l(S,{class:"empty-icon",src:Q}),l(T,{class:"empty-text"},{default:a((()=>[r("请选择公告查看详情")])),_:1})])),_:1}))])),_:1}),k.isLeftPanelCollapsed?(i(),s(R,{key:0,class:"expand-panel-btn",onClick:w.toggleLeftPanel},{default:a((()=>[l(T,{class:"expand-text"},{default:a((()=>[r("展开列表")])),_:1}),l(S,{class:"expand-icon",src:I})])),_:1},8,["onClick"])):p("",!0)])),_:1},8,["class"])])),_:1})])),_:1})}],["__scopeId","data-v-7434cd9f"]]);export{k as default};
