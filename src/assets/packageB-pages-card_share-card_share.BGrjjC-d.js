import{I as e,g as t,b as a,s,d as l,Q as r,R as i,T as n,M as o,U as c,m as h,w as d,o as u,p as f,q as g,y as C,u as p,x as w,A as m,B as x,F as v,z as _,t as y,C as S,E as T,J as k,D as b,K as E,H as I,V as F,L as B}from"./index-BrYrmhwU.js";import{_ as L}from"./empty-icon.8qvP3JRT.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=A({data:()=>({characterData:[],filteredBoxes:[],displayBoxes:[],ownedCharacters:{},wantedCharacters:[],tradeCharacters:{},currentMode:"show",wantMode:!1,eliteLevel:"all",boxFilterIndex:0,boxFilterOptions:["å…¨éƒ¨ç›’å­","å¸¸è§„æ¬¾","ç™½åå•","ç‰¹åˆ«é€šè¡Œ","è”åŠ¨æ¬¾","éŸ³å¾‹è”è§‰"],boxFilterMap:{0:"all",1:"normal",2:"whitelist",3:"special",4:"cooperation",5:"ambience"},pageSize:3,currentPage:1,hasMore:!0,scrollTop:0,showSharePreviewModal:!1,isGeneratingShareImage:!1,shareImagePath:"",shareShowPrices:!0,shareShowWanted:!0,watermarkText:"æ˜æ—¥æ–¹èˆŸé€šè¡Œè¯æ”¶é›†",shareGeneratedTime:"",defaultAvatar:"/static/default-avatar.png",ownedCount:0,wantedCount:0,tradeCount:0,totalCharacters:0}),computed:{currentBoxFilter(){return this.boxFilterMap[this.boxFilterIndex]||"all"},isAllSelected(){return this.getAllCharactersList().every((e=>e&&this.isCharacterOwned(e.name)))}},onLoad(){e({title:"æˆ‘çš„é€šè¡Œè¯åˆ†äº«"}),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:()=>({title:"æ–¹èˆŸé€šè¡Œè¯è°·å­æŸ¥è¯¢å·¥å…·-é€šè¡Œè¯åˆ†äº«",path:"/packageB/pages/card_share/card_share",imageUrl:""}),onShareTimeline:()=>({title:"æ–¹èˆŸé€šè¡Œè¯è°·å­æŸ¥è¯¢å·¥å…·-é€šè¡Œè¯åˆ†äº«",imageUrl:""}),onShow(){this.loadUserData()},methods:{async loadData(){try{console.log("å¼€å§‹åŠ è½½è§’è‰²æ•°æ®...");const e=t("arknightsData"),s=t("guessData"),l=t("enableGuessData");console.log("ä¸»æ•°æ®:",(null==e?void 0:e.length)||0,"æ¡"),console.log("çŒœæµ‹æ•°æ®:",(null==s?void 0:s.length)||0,"æ¡"),console.log("å¯ç”¨çŒœæµ‹æ•°æ®:",l);let r=[];e&&Array.isArray(e)&&e.length>0&&(r=[...e]),"true"===l&&s&&Array.isArray(s)&&s.length>0&&(r=[...r,...s]),console.log("æ€»æ•°æ®:",r.length,"æ¡"),r.length>0?(this.characterData=r.filter((e=>e&&"object"==typeof e)),console.log("æœ‰æ•ˆæ•°æ®:",this.characterData.length,"æ¡"),this.applyFilter(),this.calculateStatistics()):(console.warn("æ²¡æœ‰æ•°æ®"),a({title:"è¯·å…ˆåŠ è½½æ•°æ®",icon:"none"}))}catch(e){console.error("åŠ è½½æ•°æ®å¤±è´¥:",e),a({title:"åŠ è½½æ•°æ®å¤±è´¥",icon:"none"})}},loadUserData(){try{console.log("å¼€å§‹åŠ è½½ç”¨æˆ·æ•°æ®...");const e=t("ownedCharacters")||{};this.ownedCharacters=e,console.log("æ‹¥æœ‰çš„è§’è‰²:",Object.keys(e).length,"ä¸ª");const a=t("wantedCharacters")||[];this.wantedCharacters=a,console.log("æƒ³è¦çš„è§’è‰²:",a.length,"ä¸ª");const s=t("tradeCharacters")||{};this.tradeCharacters=s,console.log("å‡ºç‰©çš„è§’è‰²:",Object.keys(s).length,"ä¸ª"),console.log("ç”¨æˆ·æ•°æ®åŠ è½½å®Œæˆ"),this.calculateStatistics()}catch(e){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},saveUserData(){try{s("ownedCharacters",this.ownedCharacters),s("wantedCharacters",this.wantedCharacters),s("tradeCharacters",this.tradeCharacters),console.log("ç”¨æˆ·æ•°æ®ä¿å­˜æˆåŠŸ")}catch(e){console.error("ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}},syncWithFavorites(){try{(t("favoriteCharacterNames")||[]).forEach((e=>{this.ownedCharacters[e]?this.ownedCharacters={...this.ownedCharacters,[e]:{...this.ownedCharacters[e],elite1:!0}}:this.ownedCharacters={...this.ownedCharacters,[e]:{elite1:!0,elite2:!1,boxId:this.findCharacterBox(e)}}})),this.saveUserData(),this.calculateStatistics(),a({title:"å·²ä»æ”¶è—åŒæ­¥",icon:"success"})}catch(e){console.error("åŒæ­¥å¤±è´¥:",e),a({title:"åŒæ­¥å¤±è´¥",icon:"none"})}},findCharacterBox(e){for(const t of this.characterData){if(!t)continue;const a=this.getBoxCharacters(t);for(const s of a)if(s&&s.name===e)return t.Box_id||""}return""},getBoxCharacters(e){if(!e||"object"!=typeof e)return console.warn("getBoxCharacters: box is undefined or not an object",e),[];const t=[];for(let a=1;a<=10;a++){const s=`character${a}`;if(e[s]){let a="",l="",r=!1,i=!1,n=null;"string"==typeof e[s]?a=e[s]:e[s]&&e[s].name&&(a=e[s].name,l=e[s].imageUrl||"",r=!0===e[s].nolyELITE1,i=!0===e[s].hotcharacter,n=e[s].market_price||null),a&&a.trim()&&t.push({name:a,avatar:l||this.defaultAvatar,nolyELITE1:r,hotcharacter:i,market_price:n,boxId:e.Box_id||""})}}return t},getFilteredCharacters(e){if(!e)return console.warn("getFilteredCharacters: box is undefined"),[];const t=this.getBoxCharacters(e);return"all"===this.eliteLevel?t:t.filter((e=>!!e&&("elite1"===this.eliteLevel?e.nolyELITE1||this.isCharacterOwnedAtLevel(e.name,"elite1"):"elite2"!==this.eliteLevel||!e.nolyELITE1&&this.isCharacterOwnedAtLevel(e.name,"elite2"))))},getAllCharactersList(){let e=[];for(const t of this.characterData){if(!t)continue;const a=this.getBoxCharacters(t);e=e.concat(a)}return e},applyFilter(){let e=[...this.characterData].filter((e=>e&&"object"==typeof e));"all"!==this.currentBoxFilter&&(e=e.filter((e=>{const t=e.Box_type||"normal";return"normal"===this.currentBoxFilter?!t||"normal"===t:t===this.currentBoxFilter}))),this.filteredBoxes=e,this.currentPage=1,this.loadDisplayBoxes(),this.calculateStatistics()},loadDisplayBoxes(){const e=this.currentPage*this.pageSize;this.displayBoxes=this.filteredBoxes.slice(0,e),this.hasMore=e<this.filteredBoxes.length},loadMore(){if(!this.hasMore||0===this.filteredBoxes.length)return;this.currentPage++;const e=this.currentPage*this.pageSize;this.displayBoxes=this.filteredBoxes.slice(0,e),this.hasMore=e<this.filteredBoxes.length},onBoxFilterChange(e){this.boxFilterIndex=parseInt(e.detail.value)||0,this.applyFilter()},changeMode(e){this.currentMode=e,"trade"===e&&a({title:"å‡ºç‰©æ¨¡å¼ï¼šç‚¹å‡»è§’è‰²æ ‡è®°ä¸ºå¯å‡ºç‰©ï¼Œé•¿æŒ‰æ ‡è®°ä¸ºæƒ³è¦çš„",icon:"none",duration:3e3})},toggleWantMode(){this.wantMode=!this.wantMode,this.wantMode&&a({title:"é•¿æŒ‰è§’è‰²æ ‡è®°ä¸ºæƒ³è¦çš„",icon:"none",duration:2e3})},setEliteLevel(e){this.eliteLevel=e},onAvatarError(e){e&&(e.avatar=this.defaultAvatar)},isCharacterOwned(e){if(!e)return!1;const t=this.ownedCharacters[e];return t&&(t.elite1||t.elite2)},isCharacterOwnedAtLevel(e,t){if(!e)return!1;const a=this.ownedCharacters[e];return!!a&&("elite1"===t?a.elite1:a.elite2)},isCharacterWanted(e){return!!e&&this.wantedCharacters.includes(e)},isCharacterForTrade(e){if(!e)return!1;const t=this.tradeCharacters[e];return t&&(t.elite1||t.elite2)},getTradePrice(e,t){if(!e)return"";const a=this.tradeCharacters[e];return a&&a[t]&&a[t].price||""},setTradePrice(e,t,s){if(!e)return;if(!this.isCharacterOwnedAtLevel(e,t))return void a({title:"è¯·å…ˆç‚¹äº®è§’è‰²çš„"+("elite1"===t?"ç²¾ä¸€":"ç²¾äºŒ"),icon:"none"});const l=parseFloat(s);if(s&&isNaN(l))a({title:"è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼",icon:"none"});else{if(this.tradeCharacters={...this.tradeCharacters,[e]:{...this.tradeCharacters[e]||{},[t]:{price:l||0,note:""}}},!l){const a={...this.tradeCharacters};a[e]&&(delete a[e][t],a[e].elite1||a[e].elite2||delete a[e]),this.tradeCharacters=a}this.saveUserData(),this.calculateStatistics()}},toggleCharacterOwnership(e,t){if(!e)return;const a=e.name;if(this.wantMode)this.toggleCharacterWant(a);else if("trade"!==this.currentMode)this.toggleCharacterOwnershipSimple(a,t);else{if(this.isCharacterOwned(a))return;this.toggleCharacterOwnershipSimple(a,t)}},toggleCharacterOwnershipSimple(e,t){if(!e)return;const a=this.ownedCharacters[e];if(a){const s=this.findCharacterByName(e);if(s&&s.nolyELITE1){const t={...this.ownedCharacters};delete t[e],this.ownedCharacters=t}else if(a.elite1&&!a.elite2)this.ownedCharacters={...this.ownedCharacters,[e]:{elite1:!1,elite2:!0,boxId:t||a.boxId}};else if(!a.elite1&&a.elite2){const t={...this.ownedCharacters};delete t[e],this.ownedCharacters=t}else this.ownedCharacters={...this.ownedCharacters,[e]:{elite1:!0,elite2:!1,boxId:t||a.boxId}}}else this.ownedCharacters={...this.ownedCharacters,[e]:{elite1:!0,elite2:!1,boxId:t||""}};this.saveUserData(),this.calculateStatistics()},findCharacterByName(e){if(!e)return null;for(const t of this.characterData){if(!t)continue;const a=this.getBoxCharacters(t);for(const t of a)if(t&&t.name===e)return t}return null},toggleCharacterWant(e){if(!e)return;const t=this.wantedCharacters.indexOf(e);t>-1?this.wantedCharacters.splice(t,1):this.wantedCharacters.push(e),this.saveUserData(),this.calculateStatistics()},toggleSelectAll(){const e=this.getAllCharactersList();if(this.isAllSelected)this.ownedCharacters={},this.tradeCharacters={};else{const t={};e.forEach((e=>{e&&(t[e.name]={elite1:!0,elite2:!e.nolyELITE1,boxId:e.boxId})})),this.ownedCharacters=t}this.saveUserData(),this.calculateStatistics()},isBoxAllSelected(e){if(!e)return!1;return this.getBoxCharacters(e).every((e=>e&&this.isCharacterOwned(e.name)))},toggleSelectBox(e){if(!e)return;const t=this.characterData.find((t=>t&&t.Box_id===e));if(!t)return;const a=this.getBoxCharacters(t);if(this.isBoxAllSelected(t)){const e={...this.ownedCharacters};a.forEach((t=>{t&&t.name&&e[t.name]&&delete e[t.name]})),this.ownedCharacters=e}else{const t={...this.ownedCharacters};a.forEach((a=>{a&&a.name&&(t[a.name]={elite1:!0,elite2:!a.nolyELITE1,boxId:e})})),this.ownedCharacters=t}this.saveUserData(),this.calculateStatistics()},selectAllElite1(){const e=this.getAllCharactersList(),t={...this.ownedCharacters};e.forEach((e=>{e&&(t[e.name]?t[e.name].elite1=!0:t[e.name]={elite1:!0,elite2:!1,boxId:e.boxId})})),this.ownedCharacters=t,this.saveUserData(),this.calculateStatistics(),a({title:"å·²å…¨é€‰ç²¾ä¸€",icon:"success"})},selectAllElite2(){const e=this.getAllCharactersList(),t={...this.ownedCharacters};e.forEach((e=>{e&&(e.nolyELITE1||(t[e.name]?t[e.name].elite2=!0:t[e.name]={elite1:!1,elite2:!0,boxId:e.boxId}))})),this.ownedCharacters=t,this.saveUserData(),this.calculateStatistics(),a({title:"å·²å…¨é€‰å¯ç²¾äºŒè§’è‰²",icon:"success"})},clearAll(){l({title:"ç¡®è®¤æ¸…ç©º",content:"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç‚¹äº®çŠ¶æ€å—ï¼Ÿ",success:e=>{e.confirm&&(this.ownedCharacters={},this.wantedCharacters=[],this.tradeCharacters={},this.saveUserData(),this.calculateStatistics(),a({title:"å·²æ¸…ç©º",icon:"success"}))}})},calculateStatistics(){this.ownedCount=Object.keys(this.ownedCharacters).length,this.wantedCount=this.wantedCharacters.length,this.tradeCount=Object.keys(this.tradeCharacters).length;const e=new Set;for(const t of this.characterData){if(!t)continue;this.getBoxCharacters(t).forEach((t=>{t&&t.name&&e.add(t.name)}))}this.totalCharacters=e.size},getBoxTypeText(e){if(!e)return"å¸¸è§„æ¬¾";return{whitelist:"ç™½åå•",special:"ç‰¹åˆ«é€šè¡Œ",cooperation:"è”åŠ¨æ¬¾",ambience:"éŸ³å¾‹è”è§‰",normal:"å¸¸è§„æ¬¾"}[e]||"å¸¸è§„æ¬¾"},getBoxTypeClass(e){if(!e)return"type-normal";return{whitelist:"type-whitelist",special:"type-special",cooperation:"type-cooperation",ambience:"type-ambience",normal:"type-normal"}[e]||"type-normal"},openSharePreview(){const e=new Date;this.shareGeneratedTime=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,this.shareImagePath="",this.showSharePreviewModal=!0},closeSharePreviewModal(){this.showSharePreviewModal=!1,this.shareImagePath=""},getShareBoxes(){return this.characterData.filter((e=>e&&"object"==typeof e))},getShareCharacters(e){if(!e)return console.warn("getShareCharacters: box is undefined"),[];return this.getBoxCharacters(e).filter((e=>!(!e||!e.name)&&("show"===this.currentMode?this.isCharacterOwned(e.name):this.isCharacterForTrade(e.name))))},getTotalShareCharacters(){let e=0;for(const t of this.getShareBoxes())e+=this.getShareCharacters(t).length;return e},async generateShareImage(){this.isGeneratingShareImage=!0;try{const t=this.prepareShareData().characters,s=4,l=Math.ceil(t.length/s),o=15,c=90,h=80+l*c+80,d=r("shareCanvas",this),u=375,f=Math.max(h,1e3);d.setFillStyle("#ffffff"),d.fillRect(0,0,u,f),d.setFontSize(18),d.setFillStyle("#333333"),d.setTextAlign("center");const g="show"===this.currentMode?"ğŸŒŸ æˆ‘çš„æ˜æ—¥æ–¹èˆŸæ”¶è— ğŸŒŸ":"ğŸ’¼ å‡ºç‰©æ¸…å• ğŸ’¼";d.fillText(g,u/2,40),d.setFontSize(12),d.setFillStyle("#666666");const C="show"===this.currentMode?"ç‚«è€€æ¨¡å¼ - å±•ç¤ºæˆ‘çš„æ‰€æœ‰æ”¶è—":"å‡ºç‰©æ¨¡å¼ - è¿™äº›è§’è‰²å¯ä»¥äº¤æ˜“";d.fillText(C,u/2,60),d.setStrokeStyle("#e0e0e0"),d.setLineWidth(1),d.moveTo(o,75),d.lineTo(u-o,75),d.stroke(),d.setFontSize(12),d.setTextAlign("left");let p=95;d.setFillStyle("#666666"),d.fillText("å·²ç‚¹äº®è§’è‰²:",o,p),d.setFillStyle("#333333"),d.setTextAlign("right"),d.fillText(`${this.ownedCount}ä¸ª`,u-o,p),d.setTextAlign("left"),p+=20,"trade"===this.currentMode&&this.tradeCount>0&&(d.setFillStyle("#666666"),d.fillText("å‡ºç‰©è§’è‰²:",o,p),d.setFillStyle("#333333"),d.setTextAlign("right"),d.fillText(`${this.tradeCount}ä¸ª`,u-o,p),d.setTextAlign("left"),p+=20),this.shareShowWanted&&this.wantedCount>0&&(d.setFillStyle("#666666"),d.fillText("æƒ³è¦çš„è§’è‰²:",o,p),d.setFillStyle("#FF6B6B"),d.setTextAlign("right"),d.fillText(`${this.wantedCount}ä¸ª`,u-o,p),d.setTextAlign("left"),p+=20),d.setFillStyle("#666666"),d.fillText("ç”Ÿæˆæ—¶é—´:",o,p),d.setFillStyle("#333333"),d.setTextAlign("right"),d.fillText(this.shareGeneratedTime,u-o,p),p+=30,d.setTextAlign("left"),d.setFontSize(15),d.setFillStyle("#333333"),d.fillText("è§’è‰²åˆ—è¡¨",o,p),p+=25;const w=(u-2*o)/s,m=40,x=8;let v=p,_=v;if(t&&t.length>0){for(let e=0;e<t.length;e++){const a=t[e],l=Math.floor(e/s),r=v+l*c;_=r;const i=o+e%s*w+w/2,n=r+x+m/2;d.setFillStyle("#f8fafc"),d.beginPath(),d.arc(i,n,m/2,0,2*Math.PI),d.fill(),d.setFontSize(12),d.setFillStyle("#333333"),d.setTextAlign("center");let h=a.name;h.length>4&&(h=h.substring(0,4));const u=r+m+2*x+12;d.fillText(h,i,u);let f=u+10,g=i-20;if(a.elite1&&(d.setFillStyle("#E6A23C"),d.fillRect(g,f,22,12),d.setFontSize(9),d.setFillStyle("#ffffff"),d.setTextAlign("center"),d.fillText("ç²¾ä¸€",g+11,f+9),g+=25),a.elite2&&!a.nolyELITE1&&(d.setFillStyle("#409EFF"),d.fillRect(g,f,22,12),d.setFontSize(9),d.setFillStyle("#ffffff"),d.setTextAlign("center"),d.fillText("ç²¾äºŒ",g+11,f+9)),this.shareShowPrices){let e=r+c-8;"trade"===this.currentMode&&a.tradePrices?(d.setFontSize(10),d.setFillStyle("#E6A23C"),d.setTextAlign("center"),a.tradePrices.elite1?d.fillText(`${a.tradePrices.elite1}å…ƒ`,i,e):a.tradePrices.elite2&&!a.nolyELITE1&&d.fillText(`${a.tradePrices.elite2}å…ƒ`,i,e)):"show"===this.currentMode&&a.marketPrices&&(d.setFontSize(10),d.setFillStyle("#E6A23C"),d.setTextAlign("center"),a.marketPrices.elite1?d.fillText(`${a.marketPrices.elite1}å…ƒ`,i,e):a.marketPrices.elite2&&!a.nolyELITE1&&d.fillText(`${a.marketPrices.elite2}å…ƒ`,i,e))}this.shareShowWanted&&a.wanted&&(d.setFontSize(14),d.setFillStyle("#FF6B6B"),d.setTextAlign("center"),d.fillText("â¤ï¸",i+15,r+m-8))}_+=c}else d.setFontSize(13),d.setFillStyle("#999999"),d.setTextAlign("center"),d.fillText("show"===this.currentMode?"æš‚æ— ç‚¹äº®è§’è‰²":"æš‚æ— å‡ºç‰©è§’è‰²",u/2,v+30),_=v+60;_+=20,d.setFontSize(10),d.setFillStyle("#999999"),d.setTextAlign("center"),d.fillText(this.watermarkText,u/2,_),_+=20;try{const e=await new Promise(((e,t)=>{i({src:"/static/Searchus.png",success:e,fail:t})})),t=90,a=e.height*t/e.width,s=(u-t)/2,l=_;d.drawImage("/static/Searchus.png",s,l,t,a),_+=a+10}catch(e){console.error("åŠ è½½Searchus.pngå¤±è´¥:",e),d.setFontSize(11),d.setFillStyle("#999999"),d.setTextAlign("center"),d.fillText('å¾®ä¿¡æœç´¢"æ–¹èˆŸé€šè¡Œè¯è°·å­æŸ¥è¯¢å·¥å…·"è·å–æ›´å¤š~',u/2,_),_+=15}d.setFontSize(10),d.setFillStyle("#999999"),d.fillText("é•¿æŒ‰ä¿å­˜å›¾ç‰‡ï¼Œåˆ†äº«ç»™å¥½å‹",u/2,_),await new Promise(((e,t)=>{d.draw(!0,(()=>{setTimeout((()=>{e()}),500)}))})),await new Promise(((e,t)=>{n({canvasId:"shareCanvas",fileType:"png",quality:1,success:t=>{console.log("Canvasç”Ÿæˆå›¾ç‰‡æˆåŠŸ:",t.tempFilePath),this.shareImagePath=t.tempFilePath,e()},fail:e=>{console.error("Canvasç”Ÿæˆå›¾ç‰‡å¤±è´¥:",e),t(e)}},this)})),a({title:"åˆ†äº«å›¾ç”ŸæˆæˆåŠŸ",icon:"success"})}catch(t){console.error("ç”Ÿæˆåˆ†äº«å›¾å¤±è´¥:",t),a({title:"ç”Ÿæˆåˆ†äº«å›¾å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{this.isGeneratingShareImage=!1}},prepareShareData(){const e=[];for(const t of this.getShareBoxes()){const a=this.getShareCharacters(t);for(const t of a){if(!t||!t.name)continue;const a={name:t.name,elite1:this.isCharacterOwnedAtLevel(t.name,"elite1"),elite2:this.isCharacterOwnedAtLevel(t.name,"elite2"),wanted:this.isCharacterWanted(t.name),nolyELITE1:t.nolyELITE1};"trade"===this.currentMode&&this.isCharacterForTrade(t.name)?a.tradePrices={elite1:this.getTradePrice(t.name,"elite1"),elite2:this.getTradePrice(t.name,"elite2")}:"show"===this.currentMode&&t.market_price&&(a.marketPrices={elite1:t.market_price.ELITE1,elite2:t.market_price.ELITE2}),e.push(a)}}return{characters:e,ownedCount:this.ownedCount,tradeCount:this.tradeCount,wantedCount:this.wantedCount}},previewShareImage(){this.shareImagePath?o({urls:[this.shareImagePath],current:0,success:()=>{console.log("é¢„è§ˆå›¾ç‰‡æˆåŠŸ")},fail:e=>{console.error("é¢„è§ˆå›¾ç‰‡å¤±è´¥:",e),a({title:"é¢„è§ˆå›¾ç‰‡å¤±è´¥",icon:"none"})}}):a({title:"è¯·å…ˆç”Ÿæˆåˆ†äº«å›¾",icon:"none"})},saveShareImage(){this.shareImagePath?c({filePath:this.shareImagePath,success:()=>{a({title:"ä¿å­˜æˆåŠŸ",icon:"success"})},fail:e=>{console.error("ä¿å­˜å¤±è´¥:",e),e.errMsg&&e.errMsg.includes("auth")?l({title:"éœ€è¦æˆæƒ",content:"éœ€è¦ç›¸å†Œæƒé™æ‰èƒ½ä¿å­˜å›¾ç‰‡",success:e=>{e.confirm&&uni.openSetting()}}):a({title:"ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™",icon:"none"})}}):a({title:"è¯·å…ˆç”Ÿæˆåˆ†äº«å›¾",icon:"none"})},splitTextToLines(e,t,a){if(!e||e.length<=t)return[e];const s=[];let l="";for(let r=0;r<e.length;r++)l+=e[r],(l.length>=t||"\n"===e[r])&&(s.push(l.trim()),l="");return l.length>0&&s.push(l.trim()),s}}},[["render",function(e,t,a,s,l,r){const i=S,n=u,o=T,c=k,A=b,M=B,P=E,O=I,D=F;return f(),h(n,{class:"container"},{default:d((()=>[g(n,{class:"mode-section"},{default:d((()=>[g(n,{class:"mode-tabs"},{default:d((()=>[g(n,{class:C(["mode-tab",{active:"show"===l.currentMode}]),onClick:t[0]||(t[0]=e=>r.changeMode("show"))},{default:d((()=>[g(i,{class:"mode-icon"},{default:d((()=>[p("ğŸŒŸ")])),_:1}),g(i,{class:"mode-text"},{default:d((()=>[p("ç‚«è€€æ¨¡å¼")])),_:1})])),_:1},8,["class"]),g(n,{class:C(["mode-tab",{active:"trade"===l.currentMode}]),onClick:t[1]||(t[1]=e=>r.changeMode("trade"))},{default:d((()=>[g(i,{class:"mode-icon"},{default:d((()=>[p("ğŸ’¼")])),_:1}),g(i,{class:"mode-text"},{default:d((()=>[p("å‡ºç‰©æ¨¡å¼")])),_:1})])),_:1},8,["class"])])),_:1}),g(n,{class:"action-buttons"},{default:d((()=>[g(o,{class:"action-btn select-all-btn",onClick:r.toggleSelectAll},{default:d((()=>[p(w(r.isAllSelected?"å–æ¶ˆå…¨é€‰":"å…¨é€‰ç‚¹äº®"),1)])),_:1},8,["onClick"]),g(o,{class:"action-btn share-btn",onClick:r.openSharePreview,disabled:l.isGeneratingShareImage},{default:d((()=>[p(w(l.isGeneratingShareImage?"ç”Ÿæˆä¸­...":"ç”Ÿæˆåˆ†äº«å›¾"),1)])),_:1},8,["onClick","disabled"]),g(o,{class:C(["action-btn want-btn",{active:l.wantMode}]),onClick:r.toggleWantMode},{default:d((()=>[p(w(l.wantMode?"å–æ¶ˆæƒ³è¦":"æ ‡è®°æƒ³è¦çš„"),1)])),_:1},8,["onClick","class"])])),_:1})])),_:1}),g(n,{class:"filter-stats-section"},{default:d((()=>[g(c,{class:"box-filter-picker",onChange:r.onBoxFilterChange,value:l.boxFilterIndex,range:l.boxFilterOptions},{default:d((()=>[g(n,{class:"picker-text"},{default:d((()=>[p(w(l.boxFilterOptions[l.boxFilterIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"]),g(n,{class:"stats-info"},{default:d((()=>[g(i,{class:"stat-item"},{default:d((()=>[p("ç‚¹äº®: "+w(l.ownedCount)+"/"+w(l.totalCharacters),1)])),_:1}),g(i,{class:"stat-item"},{default:d((()=>[p("æƒ³è¦: "+w(l.wantedCount),1)])),_:1}),g(i,{class:"stat-item"},{default:d((()=>[p("å‡ºç‰©: "+w(l.tradeCount),1)])),_:1})])),_:1})])),_:1}),g(n,{class:"elite-level-selector"},{default:d((()=>[g(n,{class:C(["elite-option",{active:"all"===l.eliteLevel}]),onClick:t[2]||(t[2]=e=>r.setEliteLevel("all"))},{default:d((()=>[g(i,null,{default:d((()=>[p("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),g(n,{class:C(["elite-option",{active:"elite1"===l.eliteLevel}]),onClick:t[3]||(t[3]=e=>r.setEliteLevel("elite1"))},{default:d((()=>[g(i,{class:"elite-tag elite1-tag"},{default:d((()=>[p("ä»…ç²¾ä¸€")])),_:1})])),_:1},8,["class"]),g(n,{class:C(["elite-option",{active:"elite2"===l.eliteLevel}]),onClick:t[4]||(t[4]=e=>r.setEliteLevel("elite2"))},{default:d((()=>[g(i,{class:"elite-tag elite2-tag"},{default:d((()=>[p("ç²¾äºŒ")])),_:1})])),_:1},8,["class"])])),_:1}),g(P,{class:"boxes-scroll-view","scroll-y":"",onScrolltolower:r.loadMore,"scroll-top":l.scrollTop},{default:d((()=>[(f(!0),m(v,null,x(l.displayBoxes,((e,t)=>(f(),h(n,{class:"box-section",key:(null==e?void 0:e.Box_id)||t},{default:d((()=>[g(n,{class:"box-header"},{default:d((()=>[g(i,{class:"box-title"},{default:d((()=>[p("ç›’å· "+w((null==e?void 0:e.Box_id)||"æœªçŸ¥"),1)])),_:2},1024),g(i,{class:C(["box-type-tag",r.getBoxTypeClass(null==e?void 0:e.Box_type)])},{default:d((()=>[p(w(r.getBoxTypeText(null==e?void 0:e.Box_type)),1)])),_:2},1032,["class"]),g(o,{class:"select-box-btn",onClick:t=>r.toggleSelectBox(null==e?void 0:e.Box_id)},{default:d((()=>[p(w(r.isBoxAllSelected(e)?"å–æ¶ˆå…¨é€‰":"å…¨é€‰ç‚¹äº®"),1)])),_:2},1032,["onClick"])])),_:2},1024),g(n,{class:"characters-grid"},{default:d((()=>[(f(!0),m(v,null,x(r.getFilteredCharacters(e),((t,a)=>(f(),h(n,{class:"character-item",key:a,onClick:a=>r.toggleCharacterOwnership(t,null==e?void 0:e.Box_id),onLongpress:e=>r.toggleCharacterWant(null==t?void 0:t.name)},{default:d((()=>[g(n,{class:"character-avatar-wrapper"},{default:d((()=>[g(A,{class:C(["character-avatar",{owned:r.isCharacterOwned(null==t?void 0:t.name),grayed:!r.isCharacterOwned(null==t?void 0:t.name),wanted:r.isCharacterWanted(null==t?void 0:t.name),"for-trade":r.isCharacterForTrade(null==t?void 0:t.name)}]),src:(null==t?void 0:t.avatar)||l.defaultAvatar,mode:"aspectFit",onError:e=>r.onAvatarError(t)},null,8,["class","src","onError"]),g(n,{class:"status-indicators"},{default:d((()=>[r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite1")?(f(),h(n,{key:0,class:"owned-indicator elite1-indicator"},{default:d((()=>[p(" â…  ")])),_:1})):_("",!0),r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite2")&&!(null==t?void 0:t.nolyELITE1)?(f(),h(n,{key:1,class:"owned-indicator elite2-indicator"},{default:d((()=>[p(" â…¡ ")])),_:1})):_("",!0),r.isCharacterWanted(null==t?void 0:t.name)?(f(),h(n,{key:2,class:"want-indicator"},{default:d((()=>[p(" â¤ï¸ ")])),_:1})):_("",!0),r.isCharacterForTrade(null==t?void 0:t.name)?(f(),h(n,{key:3,class:"trade-indicator"},{default:d((()=>[p(" ğŸ’¼ ")])),_:1})):_("",!0),(null==t?void 0:t.hotcharacter)?(f(),h(n,{key:4,class:"hot-indicator"},{default:d((()=>[p(" ğŸ”¥ ")])),_:1})):_("",!0)])),_:2},1024),(null==t?void 0:t.market_price)&&"show"===l.currentMode?(f(),h(n,{key:0,class:"price-tags"},{default:d((()=>[t.market_price.ELITE1?(f(),h(i,{key:0,class:"price-tag elite1-tag"},{default:d((()=>[p(w(t.market_price.ELITE1),1)])),_:2},1024)):_("",!0),t.market_price.ELITE2&&!t.nolyELITE1?(f(),h(i,{key:1,class:"price-tag elite2-tag"},{default:d((()=>[p(w(t.market_price.ELITE2),1)])),_:2},1024)):_("",!0)])),_:2},1024)):_("",!0),"trade"===l.currentMode&&r.isCharacterOwned(null==t?void 0:t.name)?(f(),h(n,{key:1,class:"trade-price-inputs"},{default:d((()=>[g(n,{class:"price-input-row"},{default:d((()=>[(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(i,{key:0,class:"price-label"},{default:d((()=>[p("ç²¾ä¸€:")])),_:1})),(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(M,{key:1,class:"price-input",type:"number",placeholder:r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite1")?"å‡ºä»·":"-",disabled:!r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite1"),value:r.getTradePrice(null==t?void 0:t.name,"elite1"),onInput:e=>r.setTradePrice(null==t?void 0:t.name,"elite1",e.detail.value)},null,8,["placeholder","disabled","value","onInput"])),(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(i,{key:2,class:"price-unit"},{default:d((()=>[p("å…ƒ")])),_:1}))])),_:2},1024),g(n,{class:"price-input-row"},{default:d((()=>[(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(i,{key:0,class:"price-label"},{default:d((()=>[p("ç²¾äºŒ:")])),_:1})),(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(M,{key:1,class:"price-input",type:"number",placeholder:r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite2")?"å‡ºä»·":"-",disabled:!r.isCharacterOwnedAtLevel(null==t?void 0:t.name,"elite2"),value:r.getTradePrice(null==t?void 0:t.name,"elite2"),onInput:e=>r.setTradePrice(null==t?void 0:t.name,"elite2",e.detail.value)},null,8,["placeholder","disabled","value","onInput"])),(null==t?void 0:t.nolyELITE1)?_("",!0):(f(),h(i,{key:2,class:"price-unit"},{default:d((()=>[p("å…ƒ")])),_:1})),(null==t?void 0:t.nolyELITE1)?(f(),h(i,{key:3,class:"only-elite1-tip"},{default:d((()=>[p("ä»…ç²¾ä¸€")])),_:1})):_("",!0)])),_:2},1024)])),_:2},1024)):_("",!0)])),_:2},1024),g(i,{class:"character-name"},{default:d((()=>[p(w((null==t?void 0:t.name)||"æœªçŸ¥è§’è‰²"),1)])),_:2},1024)])),_:2},1032,["onClick","onLongpress"])))),128))])),_:2},1024)])),_:2},1024)))),128)),l.hasMore&&l.filteredBoxes.length>0?(f(),h(n,{key:0,class:"load-more"},{default:d((()=>[g(i,null,{default:d((()=>[p("åŠ è½½æ›´å¤š...")])),_:1})])),_:1})):_("",!0),0===l.displayBoxes.length?(f(),h(n,{key:1,class:"empty-state"},{default:d((()=>[g(A,{class:"empty-icon",src:L}),g(i,{class:"empty-text"},{default:d((()=>[p("æš‚æ— æ•°æ®æˆ–æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è§’è‰²")])),_:1}),g(o,{class:"sync-btn",onClick:r.syncWithFavorites},{default:d((()=>[p(" âœ¨ ä»æ”¶è—åŒæ­¥ ")])),_:1},8,["onClick"])])),_:1})):_("",!0)])),_:1},8,["onScrolltolower","scroll-top"]),l.showSharePreviewModal?(f(),h(n,{key:0,class:"share-preview-modal",onClick:r.closeSharePreviewModal},{default:d((()=>[g(n,{class:"share-preview-content",onClick:t[7]||(t[7]=y((()=>{}),["stop"]))},{default:d((()=>[g(n,{class:"share-preview-header"},{default:d((()=>[g(i,{class:"share-preview-title"},{default:d((()=>[p("åˆ†äº«å›¾é¢„è§ˆ")])),_:1}),g(o,{class:"share-close-btn",onClick:r.closeSharePreviewModal},{default:d((()=>[p("Ã—")])),_:1},8,["onClick"])])),_:1}),g(n,{class:"share-preview-body"},{default:d((()=>[g(n,{class:"share-content-preview",id:"shareContent"},{default:d((()=>[g(n,{class:"share-header"},{default:d((()=>[g(i,{class:"share-title"},{default:d((()=>[p(w("show"===l.currentMode?"ğŸŒŸ æˆ‘çš„æ˜æ—¥æ–¹èˆŸæ”¶è— ğŸŒŸ":"ğŸ’¼ å‡ºç‰©æ¸…å• ğŸ’¼"),1)])),_:1}),g(i,{class:"share-subtitle"},{default:d((()=>[p(w("show"===l.currentMode?"ç‚«è€€æ¨¡å¼ - å±•ç¤ºæˆ‘çš„æ‰€æœ‰æ”¶è—":"å‡ºç‰©æ¨¡å¼ - è¿™äº›è§’è‰²å¯ä»¥äº¤æ˜“"),1)])),_:1})])),_:1}),g(n,{class:"share-stats"},{default:d((()=>[g(n,{class:"stat-row"},{default:d((()=>[g(i,{class:"stat-label"},{default:d((()=>[p("å·²ç‚¹äº®è§’è‰²:")])),_:1}),g(i,{class:"stat-value"},{default:d((()=>[p(w(l.ownedCount)+"ä¸ª",1)])),_:1})])),_:1}),"trade"===l.currentMode&&l.tradeCount>0?(f(),h(n,{key:0,class:"stat-row"},{default:d((()=>[g(i,{class:"stat-label"},{default:d((()=>[p("å‡ºç‰©è§’è‰²:")])),_:1}),g(i,{class:"stat-value"},{default:d((()=>[p(w(l.tradeCount)+"ä¸ª",1)])),_:1})])),_:1})):_("",!0),l.wantedCount>0?(f(),h(n,{key:1,class:"stat-row"},{default:d((()=>[g(i,{class:"stat-label"},{default:d((()=>[p("æƒ³è¦çš„è§’è‰²:")])),_:1}),g(i,{class:"stat-value wanted-stat"},{default:d((()=>[p(w(l.wantedCount)+"ä¸ª",1)])),_:1})])),_:1})):_("",!0),g(n,{class:"stat-row"},{default:d((()=>[g(i,{class:"stat-label"},{default:d((()=>[p("ç”Ÿæˆæ—¶é—´:")])),_:1}),g(i,{class:"stat-value"},{default:d((()=>[p(w(l.shareGeneratedTime),1)])),_:1})])),_:1})])),_:1}),g(n,{class:"share-divider"}),g(n,{class:"share-characters-section"},{default:d((()=>[g(i,{class:"section-title"},{default:d((()=>[p("è§’è‰²åˆ—è¡¨")])),_:1}),e.box&&r.getShareCharacters(e.box).length>0?(f(!0),m(v,{key:0},x(r.getShareBoxes(),((e,t)=>(f(),h(n,{class:"share-box-section",key:(null==e?void 0:e.Box_id)||t},{default:d((()=>[g(n,{class:"share-box-header"},{default:d((()=>[g(i,{class:"share-box-title"},{default:d((()=>[p("ç›’å· "+w((null==e?void 0:e.Box_id)||"æœªçŸ¥"),1)])),_:2},1024),g(i,{class:C(["share-box-type",r.getBoxTypeClass(null==e?void 0:e.Box_type)])},{default:d((()=>[p(w(r.getBoxTypeText(null==e?void 0:e.Box_type)),1)])),_:2},1032,["class"])])),_:2},1024),g(n,{class:"share-characters-grid"},{default:d((()=>[(f(!0),m(v,null,x(r.getShareCharacters(e),((e,t)=>(f(),h(n,{class:"share-character-item",key:t},{default:d((()=>[g(n,{class:"share-character-content"},{default:d((()=>[g(i,{class:"share-character-name"},{default:d((()=>[p(w((null==e?void 0:e.name)||"æœªçŸ¥è§’è‰²"),1)])),_:2},1024),g(n,{class:"share-level-tags"},{default:d((()=>[r.isCharacterOwnedAtLevel(null==e?void 0:e.name,"elite1")?(f(),h(i,{key:0,class:"level-tag elite1-tag"},{default:d((()=>[p(" ç²¾ä¸€ ")])),_:1})):_("",!0),r.isCharacterOwnedAtLevel(null==e?void 0:e.name,"elite2")&&!(null==e?void 0:e.nolyELITE1)?(f(),h(i,{key:1,class:"level-tag elite2-tag"},{default:d((()=>[p(" ç²¾äºŒ ")])),_:1})):_("",!0)])),_:2},1024),g(n,{class:"share-status-tags"},{default:d((()=>[r.isCharacterWanted(null==e?void 0:e.name)?(f(),h(i,{key:0,class:"status-tag wanted-tag"},{default:d((()=>[p(" â¤ï¸ æƒ³è¦ ")])),_:1})):_("",!0),"trade"===l.currentMode&&r.isCharacterForTrade(null==e?void 0:e.name)?(f(),h(n,{key:1,class:"price-info"},{default:d((()=>[r.getTradePrice(null==e?void 0:e.name,"elite1")?(f(),h(i,{key:0,class:"price-tag"},{default:d((()=>[p(" ç²¾ä¸€: "+w(r.getTradePrice(null==e?void 0:e.name,"elite1"))+"å…ƒ ",1)])),_:2},1024)):_("",!0),r.getTradePrice(null==e?void 0:e.name,"elite2")&&!(null==e?void 0:e.nolyELITE1)?(f(),h(i,{key:1,class:"price-tag"},{default:d((()=>[p(" ç²¾äºŒ: "+w(r.getTradePrice(null==e?void 0:e.name,"elite2"))+"å…ƒ ",1)])),_:2},1024)):_("",!0)])),_:2},1024)):_("",!0),"show"===l.currentMode&&(null==e?void 0:e.market_price)?(f(),h(n,{key:2,class:"price-info"},{default:d((()=>[e.market_price.ELITE1?(f(),h(i,{key:0,class:"price-tag"},{default:d((()=>[p(" å¸‚ä»·: "+w(e.market_price.ELITE1)+"å…ƒ ",1)])),_:2},1024)):_("",!0),e.market_price.ELITE2&&!(null==e?void 0:e.nolyELITE1)?(f(),h(i,{key:1,class:"price-tag"},{default:d((()=>[p(" å¸‚ä»·: "+w(e.market_price.ELITE2)+"å…ƒ ",1)])),_:2},1024)):_("",!0)])),_:2},1024)):_("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128)):_("",!0),0===r.getTotalShareCharacters()?(f(),h(n,{key:1,class:"no-characters"},{default:d((()=>[g(i,{class:"no-characters-text"},{default:d((()=>[p(w("show"===l.currentMode?"æš‚æ— ç‚¹äº®è§’è‰²":"æš‚æ— å‡ºç‰©è§’è‰²"),1)])),_:1})])),_:1})):_("",!0)])),_:1}),l.watermarkText?(f(),h(n,{key:0,class:"share-watermark"},{default:d((()=>[g(i,null,{default:d((()=>[p(w(l.watermarkText),1)])),_:1})])),_:1})):_("",!0),g(n,{class:"share-footer"},{default:d((()=>[g(i,{class:"footer-text"},{default:d((()=>[p("æ–¹èˆŸé€šè¡Œè¯è°·å­æŸ¥è¯¢å·¥å…·")])),_:1}),g(i,{class:"footer-text"},{default:d((()=>[p("é•¿æŒ‰ä¿å­˜å›¾ç‰‡ï¼Œåˆ†äº«ç»™å¥½å‹")])),_:1})])),_:1})])),_:1})])),_:1}),g(n,{class:"share-preview-footer"},{default:d((()=>[g(n,{class:"share-options"},{default:d((()=>[g(n,{class:"option-item"},{default:d((()=>[g(i,{class:"option-label"},{default:d((()=>[p("æ˜¾ç¤ºä»·æ ¼:")])),_:1}),g(O,{checked:l.shareShowPrices,onChange:t[5]||(t[5]=e=>l.shareShowPrices=e.detail.value),color:"#409EFF"},null,8,["checked"])])),_:1}),l.wantedCount>0?(f(),h(n,{key:0,class:"option-item"},{default:d((()=>[g(i,{class:"option-label"},{default:d((()=>[p("æ˜¾ç¤ºæƒ³è¦:")])),_:1}),g(O,{checked:l.shareShowWanted,onChange:t[6]||(t[6]=e=>l.shareShowWanted=e.detail.value),color:"#FF6B6B"},null,8,["checked"])])),_:1})):_("",!0)])),_:1}),g(o,{class:"preview-action-btn capture-btn",onClick:r.generateShareImage,disabled:l.isGeneratingShareImage},{default:d((()=>[p(w(l.isGeneratingShareImage?"ç”Ÿæˆä¸­...":"ğŸ–¼ï¸ ç”Ÿæˆåˆ†äº«å›¾"),1)])),_:1},8,["onClick","disabled"]),l.shareImagePath?(f(),h(n,{key:0,class:"action-buttons-row"},{default:d((()=>[g(A,{src:l.shareImagePath,class:"captured-image-preview",mode:"widthFix",onClick:r.previewShareImage},null,8,["src","onClick"]),g(n,{class:"share-buttons"},{default:d((()=>[g(o,{class:"preview-action-btn save-btn",onClick:r.saveShareImage},{default:d((()=>[p(" ğŸ’¾ ä¿å­˜å›¾ç‰‡ ")])),_:1},8,["onClick"])])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})])),_:1},8,["onClick"])):_("",!0),g(D,{"canvas-id":"shareCanvas",style:{position:"absolute",left:"-9999px",top:"-9999px",width:"750rpx",height:"1334rpx"},id:"shareCanvas"}),g(n,{class:"bottom-action-bar"},{default:d((()=>[g(n,{class:"quick-actions"},{default:d((()=>[g(o,{class:"quick-btn",onClick:r.selectAllElite1},{default:d((()=>[g(i,null,{default:d((()=>[p("å…¨é€‰ç²¾ä¸€")])),_:1})])),_:1},8,["onClick"]),g(o,{class:"quick-btn",onClick:r.selectAllElite2},{default:d((()=>[g(i,null,{default:d((()=>[p("å…¨é€‰ç²¾äºŒ")])),_:1})])),_:1},8,["onClick"]),g(o,{class:"quick-btn",onClick:r.clearAll},{default:d((()=>[g(i,null,{default:d((()=>[p("æ¸…ç©ºæ‰€æœ‰")])),_:1})])),_:1},8,["onClick"])])),_:1}),g(n,{class:"summary-info"},{default:d((()=>[g(i,{class:"summary-text"},{default:d((()=>[p("å·²ç‚¹äº®: "+w(l.ownedCount)+" | æƒ³è¦: "+w(l.wantedCount),1)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-34169707"]]);export{M as default};
