import{g as a,b as e,n as t,s as o,d as s,M as l,l as r,w as c,m as i,o as n,p as h,x as d,t as f,u,y as x,z as m,A as v,F as _,q as g,D as p,B as y,C,J as k}from"./index-BFyEvU8g.js";import{_ as B}from"./empty-icon.8qvP3JRT.js";import{_ as b}from"./hot.ChjTii81.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=T({data:()=>({activeCategory:"box",favoriteBoxes:[],favoriteCharacters:[],allBoxes:[],showBoxSelectionModal:!1,modalTitle:"",modalBoxList:[],defaultAvatar:"/static/default-avatar.png"}),onLoad(){wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:()=>({title:"方舟通行证谷子查询工具-我的收藏",path:"/packageB/pages/mystarbox/mystarbox",imageUrl:""}),onShareTimeline:()=>({title:"方舟通行证谷子查询工具-我的收藏",imageUrl:""}),onShow(){this.loadFavorites()},methods:{switchCategory(a){this.activeCategory=a},loadFavorites(){try{const e=a("arknightsData")||[],t=a("guessData")||[],o="true"===a("enableGuessData");this.allBoxes=[...e],o&&(this.allBoxes=[...this.allBoxes,...t]);const s=a("favoriteBoxIds")||[];this.favoriteBoxes=this.allBoxes.filter((a=>s.includes(a.Box_id)));const l=a("favoriteCharacterNames")||[];this.favoriteCharacters=this.buildFavoriteCharacters(l),console.log(`收藏统计: ${this.favoriteBoxes.length}个盒号, ${this.favoriteCharacters.length}个干员`)}catch(t){console.error("加载收藏数据失败:",t),e({title:"加载收藏失败",icon:"none"})}},buildFavoriteCharacters(a){const e={};return this.allBoxes.forEach((t=>{for(let o=1;o<=10;o++){const s=`character${o}`;if(t[s]){let o="",l="",r=!1,c=!1,i=null;"string"==typeof t[s]?o=t[s]:t[s].name&&(o=t[s].name,l=t[s].imageUrl||"",r=!0===t[s].nolyELITE1,c=!0===t[s].hotcharacter,i=t[s].market_price||null),o&&a.includes(o)&&(e[o]||(e[o]={name:o,avatar:l||this.defaultAvatar,boxIds:[],nolyELITE1:r,hotcharacter:c,market_price:i}),e[o].boxIds.includes(t.Box_id)||e[o].boxIds.push(t.Box_id),e[o].avatar===this.defaultAvatar&&l&&(e[o].avatar=l),r&&(e[o].nolyELITE1=!0),c&&(e[o].hotcharacter=!0),i&&(e[o].market_price=i))}}})),Object.values(e).sort(((a,e)=>a.name.localeCompare(e.name,"zh-CN")))},getBoxCharacters(a){const e=[];for(let t=1;t<=10;t++){const o=`character${t}`;if(a[o]){let t="",s="",l=!1,r=!1,c=null;"string"==typeof a[o]?(t=a[o],s="",l=!1,r=!1,c=null):a[o].name&&(t=a[o].name,s=a[o].imageUrl||"",l=!0===a[o].nolyELITE1,r=!0===a[o].hotcharacter,c=a[o].market_price||null),t&&t.trim()&&e.push({name:t,avatar:s||this.defaultAvatar,nolyELITE1:l,hotcharacter:r,market_price:c})}}return e},onAvatarError(a,e){console.log(`头像加载失败: 盒${a}干员${e}`)},onCharacterAvatarError(a){this.favoriteCharacters[a]&&this.$set(this.favoriteCharacters[a],"avatar",this.defaultAvatar)},getBoxTypeText:a=>({whitelist:"白名单凭证",special:"特别通行认证",cooperation:"联动款",ambience:"音律联觉通行证",normal:"常规款"}[a]||"常规款"),getBoxTypeClass:a=>({whitelist:"type-whitelist",special:"type-special",cooperation:"type-cooperation",ambience:"type-ambience",normal:"type-normal"}[a]||"type-normal"),goToBoxInfo(a){t({url:`/pages/box_info/box_info?boxId=${a}`})},handleCharacterClick(a){t({url:`/pages/search/search?searchText=${encodeURIComponent(a)}&searchType=character`})},isFavoriteBox:e=>(a("favoriteBoxIds")||[]).includes(e),toggleFavoriteBox(t){try{const s=a("favoriteBoxIds")||[],l=s.indexOf(t);l>-1?(s.splice(l,1),e({title:"已取消收藏",icon:"success"})):(s.push(t),e({title:"收藏成功",icon:"success"})),o("favoriteBoxIds",s),this.loadFavorites()}catch(s){console.error("操作失败:",s),e({title:"操作失败",icon:"none"})}},isFavoriteCharacter:e=>(a("favoriteCharacterNames")||[]).includes(e),toggleFavoriteCharacter(t){try{const s=a("favoriteCharacterNames")||[],l=s.indexOf(t);l>-1?(s.splice(l,1),e({title:"已取消收藏",icon:"success"})):(s.push(t),e({title:"收藏成功",icon:"success"})),o("favoriteCharacterNames",s),this.loadFavorites()}catch(s){console.error("操作失败:",s),e({title:"操作失败",icon:"none"})}},handleViewBoxData(a,e){1!==e.length?(this.showBoxSelectionModal=!0,this.modalTitle=`选择 ${a} 所在的盒号`,this.modalBoxList=this.getBoxDetails(e)):this.goToBoxInfo(e[0])},getBoxDetails(a){return a.map((a=>{const e=this.allBoxes.find((e=>e.Box_id===a));if(e){const t=[];for(let a=1;a<=10;a++){const o=`character${a}`;if(e[o]){let a="";"string"==typeof e[o]?a=e[o]:e[o].name&&(a=e[o].name),a&&a.trim()&&t.push({name:a})}}return{boxId:a,boxType:e.Box_type||"normal",characters:t}}return{boxId:a,boxType:"normal",characters:[]}}))},selectBox(a){this.hideBoxSelectionModal(),this.goToBoxInfo(a)},hideBoxSelectionModal(){this.showBoxSelectionModal=!1,this.modalTitle="",this.modalBoxList=[]},navigateTo(a){t({url:a})},showClearConfirm(){const a="box"===this.activeCategory?"确定要清空所有收藏的盒号吗？此操作不可撤销。":"确定要清空所有收藏的干员吗？此操作不可撤销。";s({title:"确认清空收藏",content:a,confirmColor:"#FA5151",success:a=>{a.confirm&&this.clearAllFavorites()}})},clearAllFavorites(){try{"box"===this.activeCategory?(o("favoriteBoxIds",[]),this.favoriteBoxes=[]):(o("favoriteCharacterNames",[]),this.favoriteCharacters=[]),e({title:"已清空收藏",icon:"success"})}catch(a){console.error("清空收藏失败:",a),e({title:"清空收藏失败",icon:"none"})}},goBack(){l()}}},[["render",function(a,e,t,o,s,l){const T=p,I=i,E=y,F=C,w=k;return n(),r(I,{class:"container"},{default:c((()=>[h(I,{class:"category-options"},{default:c((()=>[h(T,{class:d(["category-btn",{active:"box"===s.activeCategory}]),onClick:e[0]||(e[0]=a=>l.switchCategory("box"))},{default:c((()=>[f(" 盒号收藏 ")])),_:1},8,["class"]),h(T,{class:d(["category-btn",{active:"character"===s.activeCategory}]),onClick:e[1]||(e[1]=a=>l.switchCategory("character"))},{default:c((()=>[f(" 干员收藏 ")])),_:1},8,["class"])])),_:1}),"box"===s.activeCategory&&s.favoriteBoxes.length>0||"character"===s.activeCategory&&s.favoriteCharacters.length>0?(n(),r(I,{key:0,class:"stats-section"},{default:c((()=>[h(E,{class:"stats-text"},{default:c((()=>[f(u("box"===s.activeCategory?`已收藏 ${s.favoriteBoxes.length} 个盒号`:`已收藏 ${s.favoriteCharacters.length} 个干员`),1)])),_:1}),"box"===s.activeCategory&&s.favoriteBoxes.length>0||"character"===s.activeCategory&&s.favoriteCharacters.length>0?(n(),r(T,{key:0,class:"clear-all-btn",onClick:l.showClearConfirm},{default:c((()=>[f(" 清空当前收藏 ")])),_:1},8,["onClick"])):x("",!0)])),_:1})):x("",!0),"box"===s.activeCategory&&0===s.favoriteBoxes.length?(n(),r(I,{key:1,class:"empty-state"},{default:c((()=>[h(F,{class:"empty-icon",src:B}),h(E,{class:"empty-text"},{default:c((()=>[f("暂无盒号收藏")])),_:1}),h(E,{class:"empty-tip"},{default:c((()=>[f("在搜索或列表页面可以收藏盒号")])),_:1}),h(I,{class:"empty-actions"},{default:c((()=>[h(T,{class:"empty-btn",onClick:e[2]||(e[2]=a=>l.navigateTo("/pages/Search/Search"))},{default:c((()=>[f("去搜索页面")])),_:1}),h(T,{class:"empty-btn",onClick:e[3]||(e[3]=a=>l.navigateTo("/pages/list/list"))},{default:c((()=>[f("去列表页面")])),_:1})])),_:1})])),_:1})):x("",!0),"character"===s.activeCategory&&0===s.favoriteCharacters.length?(n(),r(I,{key:2,class:"empty-state"},{default:c((()=>[h(F,{class:"empty-icon",src:B}),h(E,{class:"empty-text"},{default:c((()=>[f("暂无干员收藏")])),_:1}),h(E,{class:"empty-tip"},{default:c((()=>[f("在搜索结果中可以收藏干员")])),_:1}),h(T,{class:"empty-btn",onClick:e[4]||(e[4]=a=>l.navigateTo("/pages/Search/Search"))},{default:c((()=>[f("去搜索干员")])),_:1})])),_:1})):x("",!0),"box"===s.activeCategory&&s.favoriteBoxes.length>0?(n(),r(I,{key:3,class:"favorites-section"},{default:c((()=>[h(w,{class:"favorites-list","scroll-y":""},{default:c((()=>[(n(!0),m(_,null,v(s.favoriteBoxes,((a,e)=>(n(),r(I,{class:"favorite-item",key:a.Box_id},{default:c((()=>[h(I,{class:"box-header"},{default:c((()=>[h(I,{class:"box-header-left"},{default:c((()=>[h(E,{class:"box-id"},{default:c((()=>[f("盒号 "+u(a.Box_id),1)])),_:2},1024),h(E,{class:d(["box-type",l.getBoxTypeClass(a.Box_type)])},{default:c((()=>[f(u(l.getBoxTypeText(a.Box_type)),1)])),_:2},1032,["class"])])),_:2},1024),h(I,{class:"box-header-right"},{default:c((()=>[h(T,{class:d(["favorite-btn",l.isFavoriteBox(a.Box_id)?"favorited":""]),onClick:e=>l.toggleFavoriteBox(a.Box_id)},{default:c((()=>[f(u(l.isFavoriteBox(a.Box_id)?"已收藏":"收藏"),1)])),_:2},1032,["class","onClick"]),h(T,{class:"view-info-btn",onClick:e=>l.goToBoxInfo(a.Box_id)},{default:c((()=>[f(" 查看详情 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),h(I,{class:"characters-grid"},{default:c((()=>[(n(!0),m(_,null,v(l.getBoxCharacters(a),((e,t)=>(n(),r(I,{class:"character-card",key:t,onClick:a=>l.handleCharacterClick(e.name)},{default:c((()=>[h(I,{class:"character-avatar-container"},{default:c((()=>[h(F,{class:"character-avatar",src:e.avatar,mode:"aspectFit",onError:e=>l.onAvatarError(a.Box_id,t)},null,8,["src","onError"]),e.hotcharacter?(n(),r(F,{key:0,class:"hot-character-icon",src:b,mode:"aspectFit"})):x("",!0)])),_:2},1024),h(I,{class:"character-info"},{default:c((()=>[h(I,{class:"character-name-line"},{default:c((()=>[h(E,{class:"character-name"},{default:c((()=>[f(u(e.name),1)])),_:2},1024),e.nolyELITE1?(n(),r(E,{key:0,class:"elite-tag"},{default:c((()=>[f("仅精一")])),_:1})):x("",!0)])),_:2},1024),e.market_price?(n(),r(I,{key:0,class:"market-price-tags"},{default:c((()=>[e.market_price.ELITE1?(n(),r(E,{key:0,class:"price-tag elite1-tag"},{default:c((()=>[f(" 精一 "+u(e.market_price.ELITE1)+"元 ",1)])),_:2},1024)):x("",!0),e.market_price.ELITE2&&!e.nolyELITE1?(n(),r(E,{key:1,class:"price-tag elite2-tag"},{default:c((()=>[f(" 精二 "+u(e.market_price.ELITE2)+"元 ",1)])),_:2},1024)):x("",!0)])),_:2},1024)):x("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):x("",!0),"character"===s.activeCategory&&s.favoriteCharacters.length>0?(n(),r(I,{key:4,class:"favorites-section"},{default:c((()=>[h(w,{class:"favorites-list","scroll-y":""},{default:c((()=>[(n(!0),m(_,null,v(s.favoriteCharacters,((a,e)=>(n(),r(I,{class:"character-favorite-item",key:a.name+e},{default:c((()=>[h(I,{class:"character-result-header"},{default:c((()=>[h(I,{class:"character-with-avatar"},{default:c((()=>[h(I,{class:"character-avatar-container"},{default:c((()=>[h(F,{class:"character-avatar",src:a.avatar,mode:"aspectFit",onError:a=>l.onCharacterAvatarError(e)},null,8,["src","onError"]),a.hotcharacter?(n(),r(F,{key:0,class:"hot-character-icon",src:b,mode:"aspectFit"})):x("",!0)])),_:2},1024),h(I,{class:"character-info"},{default:c((()=>[h(I,{class:"character-name-line"},{default:c((()=>[h(E,{class:"label"},{default:c((()=>[f("干员：")])),_:1}),h(E,{class:"value"},{default:c((()=>[f(u(a.name),1)])),_:2},1024),a.nolyELITE1?(n(),r(E,{key:0,class:"elite-tag"},{default:c((()=>[f("仅精一")])),_:1})):x("",!0)])),_:2},1024),h(E,{class:"label"},{default:c((()=>[f("所在盒号：")])),_:1}),h(E,{class:"value"},{default:c((()=>[f(u(a.boxIds.join(", ")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(I,{class:"character-favorite-actions"},{default:c((()=>[h(T,{class:d(["favorite-btn",l.isFavoriteCharacter(a.name)?"favorited":""]),onClick:e=>l.toggleFavoriteCharacter(a.name)},{default:c((()=>[f(u(l.isFavoriteCharacter(a.name)?"已收藏":"收藏"),1)])),_:2},1032,["class","onClick"]),1===a.boxIds.length?(n(),r(T,{key:0,class:"view-info-btn",onClick:e=>l.goToBoxInfo(a.boxIds[0])},{default:c((()=>[f(" 查看盒数据 ")])),_:2},1032,["onClick"])):x("",!0),a.boxIds.length>1?(n(),r(T,{key:1,class:"view-info-btn",onClick:e=>l.handleViewBoxData(a.name,a.boxIds)},{default:c((()=>[f(" 选择盒号 ")])),_:2},1032,["onClick"])):x("",!0)])),_:2},1024)])),_:2},1024),a.market_price?(n(),r(I,{key:0,class:"market-price-section"},{default:c((()=>[h(E,{class:"market-price-title"},{default:c((()=>[f("市场价：")])),_:1}),h(I,{class:"market-price-tags"},{default:c((()=>[a.market_price.ELITE1?(n(),r(E,{key:0,class:"price-tag elite1-tag"},{default:c((()=>[f(" 精一 "+u(a.market_price.ELITE1)+"元 ",1)])),_:2},1024)):x("",!0),a.market_price.ELITE2&&!a.nolyELITE1?(n(),r(E,{key:1,class:"price-tag elite2-tag"},{default:c((()=>[f(" 精二 "+u(a.market_price.ELITE2)+"元 ",1)])),_:2},1024)):x("",!0)])),_:2},1024)])),_:2},1024)):x("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})):x("",!0),s.showBoxSelectionModal?(n(),r(I,{key:5,class:"image-modal",onClick:l.hideBoxSelectionModal},{default:c((()=>[h(I,{class:"image-modal-content",onClick:e[5]||(e[5]=g((()=>{}),["stop"]))},{default:c((()=>[h(I,{class:"image-modal-header"},{default:c((()=>[h(E,{class:"image-modal-title"},{default:c((()=>[f(u(s.modalTitle),1)])),_:1}),h(T,{class:"close-btn",onClick:l.hideBoxSelectionModal},{default:c((()=>[f("×")])),_:1},8,["onClick"])])),_:1}),h(w,{class:"image-container","scroll-y":""},{default:c((()=>[h(I,{class:"box-selection-list"},{default:c((()=>[(n(!0),m(_,null,v(s.modalBoxList,(a=>(n(),r(I,{class:"box-selection-item",key:a.boxId,onClick:e=>l.selectBox(a.boxId)},{default:c((()=>[h(I,{class:"box-selection-header"},{default:c((()=>[h(I,{class:"box-selection-left"},{default:c((()=>[h(E,{class:"box-selection-id"},{default:c((()=>[f("盒号 "+u(a.boxId),1)])),_:2},1024),h(E,{class:d(["box-selection-type",l.getBoxTypeClass(a.boxType)])},{default:c((()=>[f(u(l.getBoxTypeText(a.boxType)),1)])),_:2},1032,["class"])])),_:2},1024),h(T,{class:d(["favorite-btn-small",l.isFavoriteBox(a.boxId)?"favorited":""]),onClick:g((e=>l.toggleFavoriteBox(a.boxId)),["stop"])},{default:c((()=>[f(u(l.isFavoriteBox(a.boxId)?"★":"☆"),1)])),_:2},1032,["class","onClick"])])),_:2},1024),h(I,{class:"box-selection-characters"},{default:c((()=>[(n(!0),m(_,null,v(a.characters,(a=>(n(),r(E,{class:"box-selection-character",key:a.name},{default:c((()=>[f(u(a.name),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),h(I,{class:"image-modal-footer"},{default:c((()=>[h(E,{class:"image-tip"},{default:c((()=>[f("请选择要查看的盒号")])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])):x("",!0),h(I,{class:"footer-actions"},{default:c((()=>[h(T,{class:"back-btn",onClick:l.goBack},{default:c((()=>[f("返回上一页")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-8e32f424"]]);export{I as default};
