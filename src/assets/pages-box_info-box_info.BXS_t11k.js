import{H as e,L as a,b as o,a as t,h as l,c as s,g as i,r as n,M as r,l as c,w as d,m as f,o as g,p as u,t as h,u as m,N as x,y as _,B as p,C as b,D as y}from"./index-BFyEvU8g.js";import{_ as D}from"./empty-icon.8qvP3JRT.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=I({data:()=>({boxId:"",boxData:{},imageLoading:!1,loading:!1,isRefreshing:!1}),onLoad(a){console.log("box_info页面加载，参数:",a),this.boxId=a.boxId||"",this.loadBoxData(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),e({title:`明日方舟通行认证 ${this.boxId} 盒号信息`})},onPullDownRefresh(){console.log("触发下拉刷新"),this.handleRefresh()},onShareAppMessage(){return{title:`明日方舟通行认证 ${this.boxId} 盒号信息`,path:`/pages/box_info/box_info?boxId=${this.boxId}`,imageUrl:""}},onShareTimeline(){return{title:`明日方舟通行认证 ${this.boxId} 盒号信息`,imageUrl:""}},methods:{previewImage(){this.boxData.Box_ImageUrl&&(console.log("预览图片:",this.boxData.Box_ImageUrl),a({urls:[this.boxData.Box_ImageUrl],current:this.boxData.Box_ImageUrl,success:()=>{console.log("图片预览成功")},fail:e=>{console.error("图片预览失败:",e),o({title:"图片预览失败",icon:"none"})}}))},handleRefresh(){this.isRefreshing||(this.isRefreshing=!0,console.log("开始下拉刷新数据"),t({title:"刷新中..."}),this.forceRefresh().finally((()=>{l(),s(),this.isRefreshing=!1,o({title:"刷新成功",icon:"success",duration:1500})})))},loadBoxData(){if(this.boxId){this.loading=!0;try{const e=this.loadLocalData();e&&e.length>0?(console.log("从本地缓存加载数据"),this.findBoxInData(e)):(console.log("本地无缓存数据，从网络加载"),this.loadDataFromNetwork())}catch(e){console.error("加载数据失败:",e),o({title:"数据加载失败",icon:"none"})}finally{this.loading=!1}}else o({title:"盒号参数错误",icon:"none"})},loadLocalData(){try{const e=i("arknightsData"),a=i("enableGuessData"),o=i("guessData");let t=[];return e&&Array.isArray(e)&&e.length>0&&(t=[...e],console.log("本地数据加载成功:",t.length,"个盒号")),"true"===a&&o&&Array.isArray(o)&&o.length>0&&(t=[...t,...o],console.log("合并预测数据:",o.length,"个盒号")),t}catch(e){return console.error("加载本地数据失败:",e),[]}},findBoxInData(e){console.log("在数据中查找盒号:",this.boxId);const a=e.find((e=>String(e.Box_id)===String(this.boxId)));console.log("找到的盒子数据:",a),console.log("type 字段类型:",typeof(null==a?void 0:a.type),"值:",null==a?void 0:a.type),console.log("replicate 字段类型:",typeof(null==a?void 0:a.replicate),"值:",null==a?void 0:a.replicate),a?(this.boxData=a,console.log("盒子信息数据:",{release_date:a.release_date,size:a.size,material:a.material,retail_price:a.retail_price,type:a.type,replicate:a.replicate})):(console.log("未找到盒号:",this.boxId),o({title:"未找到该盒号信息",icon:"none"}))},loadDataFromNetwork(){return new Promise(((e,a)=>{const t=i("dataUrl")||"https://raw.gitcode.com/huangjinzhou1/ArknightsAuthorization_Series/raw/main/Box_Id.json";console.log("从网络加载数据，URL:",t),n({url:t,method:"GET",timeout:15e3,success:t=>{if(200===t.statusCode){let s=t.data;if("string"==typeof s)try{s=JSON.parse(s)}catch(l){return console.error("JSON解析失败:",l),o({title:"数据格式错误",icon:"none"}),void a(l)}Array.isArray(s)?(console.log("网络数据加载成功，总数:",s.length),this.findBoxInData(s),e(s)):(o({title:"数据格式不正确",icon:"none"}),a(new Error("数据格式不正确")))}else o({title:`服务器错误: ${t.statusCode}`,icon:"none"}),a(new Error(`服务器错误: ${t.statusCode}`))},fail:e=>{console.error("网络请求失败:",e),o({title:"网络请求失败",icon:"none"}),a(e)}})}))},getTypeText:e=>(console.log("getTypeText 输入:",e,"类型:",typeof e),!0===e||"true"===e?"盲抽":!1===e||"false"===e?"单领/赠品":"暂无记录"),getReplicateText:e=>(console.log("getReplicateText 输入:",e,"类型:",typeof e),!0===e||"true"===e?"是":!1===e||"false"===e?"否":"暂无记录"),onImageLoad(){console.log("官方大图加载成功"),this.imageLoading=!1},onImageError(){console.error("官方大图加载失败"),this.imageLoading=!1,o({title:"图片加载失败",icon:"none"})},goBack(){r()},forceRefresh(){return this.loading=!0,this.loadDataFromNetwork().finally((()=>{this.loading=!1}))}}},[["render",function(e,a,o,t,l,s){const i=p,n=f,r=b,I=y;return g(),c(n,{class:"container"},{default:d((()=>[u(n,{class:"header"},{default:d((()=>[u(i,{class:"box-title"},{default:d((()=>[h("通行认证 "+m(l.boxId),1)])),_:1})])),_:1}),u(n,{class:"info-section"},{default:d((()=>[u(n,{class:"section-title"},{default:d((()=>[h("资料")])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("发售日期")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(l.boxData.release_date||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("尺寸")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(l.boxData.size||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("材质")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(l.boxData.material||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("零售价格")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(l.boxData.retail_price||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("类型")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(s.getTypeText(l.boxData.type)),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("是否有复刻")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(m(s.getReplicateText(l.boxData.replicate)),1)])),_:1})])),_:1})])),_:1}),l.boxData.Box_ImageUrl?(g(),c(n,{key:0,class:"image-section"},{default:d((()=>[u(n,{class:"section-title"},{default:d((()=>[h("官方大图")])),_:1}),u(n,{class:"image-container"},{default:d((()=>[u(n,{class:"image-wrapper",onClick:s.previewImage},{default:d((()=>[u(r,{class:"box-image",src:l.boxData.Box_ImageUrl,mode:"widthFix",onLoad:s.onImageLoad,onError:s.onImageError,style:x({minHeight:l.imageLoading?"200px":"auto"}),"show-menu-by-longpress":""},null,8,["src","onLoad","onError","style"])])),_:1},8,["onClick"]),l.imageLoading?_("",!0):(g(),c(n,{key:0,class:"image-tip"},{default:d((()=>[u(i,null,{default:d((()=>[h("点击图片预览大图")])),_:1})])),_:1})),l.imageLoading?(g(),c(n,{key:1,class:"image-loading"},{default:d((()=>[h("图片加载中...")])),_:1})):_("",!0)])),_:1})])),_:1})):_("",!0),l.loading?(g(),c(n,{key:1,class:"loading-state"},{default:d((()=>[u(i,{class:"loading-text"},{default:d((()=>[h("正在加载数据...")])),_:1})])),_:1})):_("",!0),l.loading||l.boxData&&0!==Object.keys(l.boxData).length?_("",!0):(g(),c(n,{key:2,class:"empty-state"},{default:d((()=>[u(r,{class:"empty-icon",src:D}),u(i,{class:"empty-text"},{default:d((()=>[h("暂无该盒号信息")])),_:1}),u(I,{class:"back-btn",onClick:s.goBack},{default:d((()=>[h("返回列表")])),_:1},8,["onClick"]),u(I,{class:"refresh-btn",onClick:s.forceRefresh},{default:d((()=>[h("重新加载数据")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-2c68c17b"]]);export{k as default};
