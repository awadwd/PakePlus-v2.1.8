import{I as e,b as a,M as o,a as t,h as l,c as s,g as i,r as n,N as r,m as c,w as d,o as g,p as f,q as u,u as h,x,O as m,z as _,C as p,D as b,E as y}from"./index-BAWL4vNb.js";import{_ as I}from"./empty-icon.8qvP3JRT.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=D({data:()=>({boxId:"",boxData:{},imageLoading:!1,loading:!1,isRefreshing:!1}),onLoad(a){console.log("box_info页面加载，参数:",a),this.boxId=a.boxId||"",this.loadBoxData(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),e({title:`明日方舟通行认证 ${this.boxId} 盒号信息`})},onPullDownRefresh(){console.log("触发下拉刷新"),this.handleRefresh()},onShareAppMessage(){return{title:`明日方舟通行认证 ${this.boxId} 盒号信息`,path:`/pages/box_info/box_info?boxId=${this.boxId}`,imageUrl:""}},onShareTimeline(){return{title:`明日方舟通行认证 ${this.boxId} 盒号信息`,imageUrl:""}},methods:{gotoFeedback(){console.log("跳转到反馈问卷");try{wx&&wx.openEmbeddedMiniProgram?wx.openEmbeddedMiniProgram({appId:"wxebadf544ddae62cb",path:"pages/webview/index?sid=25733968&hash=15bc&navigateBackMiniProgram=true",success:e=>{console.log("跳转问卷成功:",e)},fail:e=>{console.error("跳转问卷失败:",e),a({title:"跳转失败，请稍后重试",icon:"none"})}}):a({title:"请在微信小程序中打开此功能",icon:"none"})}catch(e){console.error("跳转问卷异常:",e),a({title:"跳转失败",icon:"none"})}},previewImage(){this.boxData.Box_ImageUrl&&(console.log("预览图片:",this.boxData.Box_ImageUrl),o({urls:[this.boxData.Box_ImageUrl],current:this.boxData.Box_ImageUrl,success:()=>{console.log("图片预览成功")},fail:e=>{console.error("图片预览失败:",e),a({title:"图片预览失败",icon:"none"})}}))},handleRefresh(){this.isRefreshing||(this.isRefreshing=!0,console.log("开始下拉刷新数据"),t({title:"刷新中..."}),this.forceRefresh().finally((()=>{l(),s(),this.isRefreshing=!1,a({title:"刷新成功",icon:"success",duration:1500})})))},loadBoxData(){if(this.boxId){this.loading=!0;try{const e=this.loadLocalData();e&&e.length>0?(console.log("从本地缓存加载数据"),this.findBoxInData(e)):(console.log("本地无缓存数据，从网络加载"),this.loadDataFromNetwork())}catch(e){console.error("加载数据失败:",e),a({title:"数据加载失败",icon:"none"})}finally{this.loading=!1}}else a({title:"盒号参数错误",icon:"none"})},loadLocalData(){try{const e=i("arknightsData"),a=i("enableGuessData"),o=i("guessData");let t=[];return e&&Array.isArray(e)&&e.length>0&&(t=[...e],console.log("本地数据加载成功:",t.length,"个盒号")),"true"===a&&o&&Array.isArray(o)&&o.length>0&&(t=[...t,...o],console.log("合并预测数据:",o.length,"个盒号")),t}catch(e){return console.error("加载本地数据失败:",e),[]}},findBoxInData(e){console.log("在数据中查找盒号:",this.boxId);const o=e.find((e=>String(e.Box_id)===String(this.boxId)));console.log("找到的盒子数据:",o),console.log("type 字段类型:",typeof(null==o?void 0:o.type),"值:",null==o?void 0:o.type),console.log("replicate 字段类型:",typeof(null==o?void 0:o.replicate),"值:",null==o?void 0:o.replicate),o?(this.boxData=o,console.log("盒子信息数据:",{release_date:o.release_date,size:o.size,material:o.material,retail_price:o.retail_price,type:o.type,replicate:o.replicate})):(console.log("未找到盒号:",this.boxId),a({title:"未找到该盒号信息",icon:"none"}))},loadDataFromNetwork(){return new Promise(((e,o)=>{const t=i("dataUrl")||"https://raw.gitcode.com/huangjinzhou1/ArknightsAuthorization_Series/raw/main/Box_Id.json";console.log("从网络加载数据，URL:",t),n({url:t,method:"GET",timeout:15e3,success:t=>{if(200===t.statusCode){let s=t.data;if("string"==typeof s)try{s=JSON.parse(s)}catch(l){return console.error("JSON解析失败:",l),a({title:"数据格式错误",icon:"none"}),void o(l)}Array.isArray(s)?(console.log("网络数据加载成功，总数:",s.length),this.findBoxInData(s),e(s)):(a({title:"数据格式不正确",icon:"none"}),o(new Error("数据格式不正确")))}else a({title:`服务器错误: ${t.statusCode}`,icon:"none"}),o(new Error(`服务器错误: ${t.statusCode}`))},fail:e=>{console.error("网络请求失败:",e),a({title:"网络请求失败",icon:"none"}),o(e)}})}))},getTypeText:e=>(console.log("getTypeText 输入:",e,"类型:",typeof e),!0===e||"true"===e?"盲抽":!1===e||"false"===e?"单领/赠品":"暂无记录"),getReplicateText:e=>(console.log("getReplicateText 输入:",e,"类型:",typeof e),!0===e||"true"===e?"是":!1===e||"false"===e?"否":"暂无记录"),onImageLoad(){console.log("官方大图加载成功"),this.imageLoading=!1},onImageError(){console.error("官方大图加载失败"),this.imageLoading=!1,a({title:"图片加载失败",icon:"none"})},goBack(){r()},forceRefresh(){return this.loading=!0,this.loadDataFromNetwork().finally((()=>{this.loading=!1}))}}},[["render",function(e,a,o,t,l,s){const i=p,n=g,r=b,D=y;return f(),c(n,{class:"container"},{default:d((()=>[u(n,{class:"header"},{default:d((()=>[u(i,{class:"box-title"},{default:d((()=>[h("通行认证 "+x(l.boxId),1)])),_:1})])),_:1}),u(n,{class:"info-section"},{default:d((()=>[u(n,{class:"section-title-container"},{default:d((()=>[u(i,{class:"section-title"},{default:d((()=>[h("资料")])),_:1}),u(i,{class:"feedback-link",onClick:s.gotoFeedback},{default:d((()=>[h("资料勘记有误，点我去反馈哟>")])),_:1},8,["onClick"])])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("发售日期")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(l.boxData.release_date||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("尺寸")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(l.boxData.size||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("材质")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(l.boxData.material||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("零售价格")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(l.boxData.retail_price||"暂无记录"),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("类型")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(s.getTypeText(l.boxData.type)),1)])),_:1})])),_:1}),u(n,{class:"info-item"},{default:d((()=>[u(i,{class:"info-label"},{default:d((()=>[h("是否有复刻")])),_:1}),u(i,{class:"info-value"},{default:d((()=>[h(x(s.getReplicateText(l.boxData.replicate)),1)])),_:1})])),_:1})])),_:1}),l.boxData.Box_ImageUrl?(f(),c(n,{key:0,class:"image-section"},{default:d((()=>[u(n,{class:"section-title"},{default:d((()=>[h("官方大图")])),_:1}),u(n,{class:"image-container"},{default:d((()=>[u(n,{class:"image-wrapper",onClick:s.previewImage},{default:d((()=>[u(r,{class:"box-image",src:l.boxData.Box_ImageUrl,mode:"widthFix",onLoad:s.onImageLoad,onError:s.onImageError,style:m({minHeight:l.imageLoading?"200px":"auto"}),"show-menu-by-longpress":""},null,8,["src","onLoad","onError","style"])])),_:1},8,["onClick"]),l.imageLoading?_("",!0):(f(),c(n,{key:0,class:"image-tip"},{default:d((()=>[u(i,null,{default:d((()=>[h("点击图片预览大图")])),_:1})])),_:1})),l.imageLoading?(f(),c(n,{key:1,class:"image-loading"},{default:d((()=>[h("图片加载中...")])),_:1})):_("",!0)])),_:1})])),_:1})):_("",!0),l.loading?(f(),c(n,{key:1,class:"loading-state"},{default:d((()=>[u(i,{class:"loading-text"},{default:d((()=>[h("正在加载数据...")])),_:1})])),_:1})):_("",!0),l.loading||l.boxData&&0!==Object.keys(l.boxData).length?_("",!0):(f(),c(n,{key:2,class:"empty-state"},{default:d((()=>[u(r,{class:"empty-icon",src:I}),u(i,{class:"empty-text"},{default:d((()=>[h("暂无该盒号信息")])),_:1}),u(D,{class:"back-btn",onClick:s.goBack},{default:d((()=>[h("返回列表")])),_:1},8,["onClick"]),u(D,{class:"refresh-btn",onClick:s.forceRefresh},{default:d((()=>[h("重新加载数据")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-5d1ee1bf"]]);export{k as default};
